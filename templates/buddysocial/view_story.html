{% extends "base.html" %}
{% load static %}

{% block page_title %}
View Story!
{% endblock page_title %}

{% block contents %}
<body class="overflow-x-hidden">
<section class="bg-canvasColor mx-auto w-screen">
    {% include "includes/success_message.html" %}
    {% include "includes/top_nav.html" %}

    <div class="relative flex items-start justify-between w-full">

        <div class="hidden lg:flex flex-col gap-4 rounded-lg fixed bg-bgColor items-center justify-start py-10 text-left">
            <a href="{% url "home" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-solid fa-house" style="color: #ffffff;"></i></a>
            <a href="{% url "write-story" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-regular fa-pen-to-square" style="color: #ffffff;"></i></a>
            <a href="{% url "chat" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-regular fa-comment-dots" style="color: #ffffff;"></i></a>
            <a href="{% url "bookmark" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-regular fa-bookmark" style="color: #ffffff;"></i></a>
            {% if user.is_authenticated %}
            <a href="{% url "profile"  profile.user.username %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-regular fa-user" style="color: #ffffff;"></i></a>
            {% else %}
            <a href="{% url "profile"  "username" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-regular fa-user" style="color: #ffffff;"></i></a>
            {% endif %}
            <a href="{% url "setting" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-solid fa-gear" style="color: #ffffff;"></i></a>
            <a href="{% url "logout" %}" class="flex px-8 py-4 rounded-2xl"><i class="fa-solid fa-arrow-right-from-bracket" style="color: #ffffff;"></i></a>
        </div>

        <div class="flex items-start w-full">
            <div class="flex flex-col w-full lg:w-[50vw] gap-6 p-6 items-start lg:items-start mx-auto lg:ml-32">
                <div class="flex items-center justify-between lg:justify-start gap-20 w-[50vw] lg:w-full">
                    <a href="{% url "home" %}"><i class="fa-solid fa-arrow-left" style="color: #ffffff;"></i></a>
                    <h2 class="text-white text-[1.2rem] font-semibold">Story</h2>
                </div>
                <div class="flex flex-col gap-4 items-start mb-20 lg:mb-0 border-t py-4 border-textCol/40 w-full">
                    <div class="flex gap-4 items-center">
                        {% if story.profile.profile_picture %}
                            <a href="{% url "other-users-profile" username=story.user.username %}"><img src="{{ story.profile.profile_picture.url }}" alt="" srcset="" class="w-[3rem] rounded-full"></a>
                        {% else %}
                            <a href="{% url "other-users-profile" username=story.user.username %}"><img src="{% static "images/blank-picture.png" %}" alt="" srcset="" class="w-[3rem] rounded-full"></a>
                        {% endif %}
                        <div class="flex flex-col gap-0 md:gap-4 md:flex-row items-start md:items-center">
                            {% if story.profile.display_name %}
                                <h6 class="text-white">{{ story.profile.display_name }}</h6>
                            {% else %}
                                <h6 class="text-white">{{ story.user.username|title }}</h6>
                            {% endif %}
                            <p class="text-textCol">@{{ story.user.username|lower }}</p>
                        </div>
                    </div>
                    <div class="flex items-start justify-start w-full text-[#F5F5F5] font-normal">{{ story.contents|linebreaksbr }}</div>
                    {% if story.story_image %}
                        <img src="{{ story.story_image.url }}" alt="" srcset="" class="w-full max-h-[20rem] md:max-h-[25rem] mt-6 rounded-lg">
                    {% endif %}
                    <div class="flex items-center justify-between w-full gap-6">
                        <div class="flex items-center gap-6">
                            <a href="{% url "view-story" username=story.user.username slug=story.slug %}" class="flex items-center gap-2 text-textCol text-sm"><i class="fa-regular fa-comment" style="color: #6C757D;"></i> {{ comments|length }}</a>
                            <form method="POST" id="like-form" class="like-form flex items-center gap-2 text-textCol text-sm">
                                {% csrf_token %}
                                <input type="hidden" class="story-like" name="story-slug" value="{{ story.slug }}">
                                <button id="like-button" class="like-button fa-regular fa-heart text-textCol"></button>
                            </form>
                            {% if story.id in all_bookmarks_id %}
                            <form action="" method="POST" class="flex items-center gap-2 text-textCol text-sm">
                                {% csrf_token %}
                                <input type="hidden" class="bookmark-story-id" name="story-to-remove-id" value="{{ story.id }}">
                                <button class="bookmark-button fa-solid fa-bookmark text-priColor"></button>
                                {{ story.number_of_bookmarks }}
                            </form>
                            {% else %}
                            <form action="" method="POST" class="flex items-center gap-2 text-textCol text-sm">
                                {% csrf_token %}
                                <input type="hidden" class="bookmark-story-id" name="story-to-save-id" value="{{ story.id }}">
                                <button class="bookmark-button fa-regular fa-bookmark text-textCol"></button>
                                {{ story.number_of_bookmarks }}
                            </form>
                            {% endif %}
                        </div>
                        <div class="flex items-center gap-2">
                            <p class=" text-textCol">{{ story.date_created|date:"jS M, f a" }}</p>
                        </div>
                    </div>

                    <!--Comment Section-->
                    <div class="flex flex-col gap-4 w-full">
                        <form action="" method="POST" class="flex flex-col gap-4 py-4 border-y border-textCol/40">
                            {% csrf_token %}
                            <h2 class="text-white text-[1.2rem] font-semibold">Leave a Comment</h2>
                            <div class="flex gap-2 items-start">
                                <textarea name="comment-content" id="write-story" placeholder="What do you think?" class="bg-transparent w-full text-white border-none focus:border-none focus:outline-none focus:ring-0 resize-none"></textarea>
                            </div>
                            <div id="send-and-photo-btn" class="hidden justify-between items-center w-full">
                                <button class="flex items-center gap-2 text-white bg-priColor px-6 py-2 hover:bg-transparent hover:border hover:border-white transition duration-200 rounded-lg"><i class="fa-regular fa-paper-plane" style="color: #FFFF;"></i> Comment</button>
                            </div>
                            <div id="imagePreview" class="hidden max-w-[10rem] max-h-[10rem] rounded-lg"></div>
                        </form>
                    </div>

                    <!--All Comments-->
                    {% if comments %}
                    <div class="flex flex-col w-full p-6 border border-textCol/40 rounded-lg">
                        {% for comment in comments %}
                        <div class="flex flex-col gap-4 items-start justify-start border-t border-textCol/40 py-6">
                            <div class="flex gap-4 items-center">
                                {% if comment.profile.profile_picture %}
                                    <a href="{% url "other-users-profile" username=comment.user.username %}"><img src="{{ comment.profile.profile_picture.url }}" alt="" srcset="" class="w-[3rem] rounded-full"></a>
                                {% else %}
                                    <a href="{% url "other-users-profile" username=comment.user.username %}"><img src="{% static "images/blank-picture.png" %}" alt="" srcset="" class="w-[3rem] rounded-full"></a>
                                {% endif %}
                                <div class="flex flex-col gap-0 md:gap-4 md:flex-row items-start md:items-center">
                                    {% if comment.profile.display_name %}
                                        <h6 class="text-white">{{ comment.profile.display_name }}</h6>
                                    {% else %}
                                        <h6 class="text-white">{{ comment.user.username|title }}</h6>
                                    {% endif %}
                                    <p class="text-textCol">@{{ comment.user.username|lower }}</p>
                                </div>
                            </div>
                            <div class="flex items-start justify-start w-full text-[#F5F5F5] font-normal">{{ comment.comment|linebreaksbr }}</div>
                            <div class="flex items-center gap-2">
                                <p class=" text-textCol">{{ comment.date|date:"jS M, f a" }}</p>
                            </div>
                            <!--
                            <div class="flex items-center justify-start gap-6">
                                <div class="show-comment flex cursor-pointer items-center gap-2 text-textCol text-sm"><i class="fa-regular fa-comment" style="color: #6C757D;"></i> 23</div>
                            </div>
                            -->
                            <!--Replies to the comments-->
                            <div class="comment-replies hidden flex-col items-center justify-start gap-4 w-full border-y py-4 border-textCol/40">
                                <div class="flex flex-col justify-start gap-2 w-full px-10 py-4">
                                    <div class="flex gap-4 items-center">
                                        <a href=""><img src="{% static "images/author-pic.png" %}" alt="" srcset="" class="w-[3rem]"></a>
                                        <div class="flex flex-col gap-0 md:gap-4 md:flex-row items-start md:items-center">
                                            <h6 class="text-white">Joanna Wellick</h6>
                                            <p class="text-textCol">@joanna_wellick</p>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="h-2 w-2 rounded-full bg-textCol/60"></div>
                                            <p class="text-textCol">4hr</p>
                                        </div>
                                    </div>
                                    <p class="text-[#F5F5F5]">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Corporis, temporibus!</p>
                                </div>
                                <div class="flex flex-col justify-start gap-2 w-full px-10 py-4">
                                    <div class="flex gap-4 items-center">
                                        <a href=""><img src="{% static "images/author-pic.png" %}" alt="" srcset="" class="w-[3rem]"></a>
                                        <div class="flex flex-col gap-0 md:gap-4 md:flex-row items-start md:items-center">
                                            <h6 class="text-white">Joanna Wellick</h6>
                                            <p class="text-textCol">@joanna_wellick</p>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="h-2 w-2 rounded-full bg-textCol/60"></div>
                                            <p class="text-textCol">4hr</p>
                                        </div>
                                    </div>
                                    <p class="text-[#F5F5F5]">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Corporis, temporibus!</p>
                                </div>

                            </div>
                        </div>
                        {% endfor %}

                    </div>
                    {% endif %}

                </div>

            </div>

            <!--Right Section-->
            <div class="hidden lg:flex flex-col items-start gap-10 w-[30vw] mr-20 mt-10">
                <!--Author box-->
                <div class="flex flex-col gap-4 items-center justify-center rounded-lg w-full bg-bgColor p-6">
                    <h2 class="text-textCol text-[1.2rem] font-light">AUTHOR</h2> 
                    {% if story.profile.display_name %} 
                        <h2 class="text-white text-[1.2rem] font-semibold">{{ story.profile.display_name|title }}</h2>
                    {% else %}
                        <h2 class="text-white text-[1.2rem] font-semibold">{{ story.user.username|title }}</h2>
                    {% endif %} 
                    {% if story.profile.profile_picture %}
                        <a href="{% url "other-users-profile" username=story.user.username %}"><img src="{{ story.profile.profile_picture.url }}" alt="" srcset="" class="w-[5rem] rounded-full"></a>
                    {% else %}
                        <a href="{% url "other-users-profile" username=story.user.username %}"><img src="{% static "images/blank-picture.png" %}" alt="" srcset="" class="w-[5rem] rounded-full"></a>
                    {% endif %}
                    {% if story.profile.bio %}
                    <p class="text-textCol text-center">{{ story.profile.bio }}</p>
                    {% endif %}
                    {% if story.profile in who_to_follow %}
                    <form action="" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="author-to-follow" value="{{ story.profile.id }}">
                        <button class="flex items-center gap-2 text-white bg-priColor px-6 py-2 hover:bg-transparent hover:border hover:border-white transition duration-200 rounded-lg">Follow</button>
                    </form>
                    {% else %}
                    <form action="" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="author-to-unfollow" value="{{ story.profile.id }}">
                        {% if story.profile.user != request.user %}
                        <button class="flex items-center gap-2 text-white hover:bg-priColor hover:border-0 px-6 py-2 bg-transparent border border-white transition duration-200 rounded-lg">Unfollow</button>
                        {% endif %}
                    </form>
                    {% endif %}
                </div>

                <!--Latest from author-->
                {% if stories_from_author %}
                <div class="flex flex-col gap-4 w-full">
                    {% if story.profile.display_name %} 
                        <h2 class="text-white text-[1.2rem] font-semibold">Latest from {{ story.profile.display_name|title }}</h2>
                    {% else %}
                        <h2 class="text-white text-[1.2rem] font-semibold">Latest from {{ story.user.username|title }}</h2>
                    {% endif %} 
                    {% for story in stories_from_author  %}
                    <div class="flex flex-col gap-6 p-6 w-full border border-textCol/40 rounded-lg">
                        <a href="{% url "view-story" username=story.user.username slug=story.slug %}"><p class="text-[#F5F5F5]">{{ story.contents|linebreaksbr|truncatewords:20 }}</p></a>
                        <div class="flex items-center justify-start gap-6">
                            <p class=" text-textCol">{{ story.date_created|date:"jS M, f a" }}</p>
                            <a href="{% url "view-story" username=story.user.username slug=story.slug %}" class="flex items-center gap-2 text-textCol text-sm"><i class="fa-regular fa-comment" style="color: #6C757D;"></i> {{ story.number_of_comments }}</a>
                            <button id="like-button" class="like-button fa-regular fa-heart text-textCol"></button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            
                <!--Who to follow-->
                {% include "includes/who-follow.html" %}
            </div>
        </div>
    </div>

        </div>
    </div>

    <!--Mobile Nav-->
    {% include "includes/mobile_nav.html" %}
</section>


<script>
    const write_story = document.getElementById("write-story")
    const send_btn = document.getElementById("send-and-photo-btn")
    var image_box = document.getElementById("imagePreview")
    write_story.addEventListener('click', increaseHieght)
    function increaseHieght() {
        write_story.classList.add('h-[10rem]');
        send_btn.classList.remove('hidden');
        send_btn.classList.add('flex');
        image_box.classList.remove('hidden');
        image_box.classList.add('flex');
    }
</script>

<script>
    function previewImage() {
      var input = document.getElementById('imageInput');
      var preview = document.getElementById('imagePreview');

      while (preview.firstChild) {
        preview.removeChild(preview.firstChild);
      }

      var file = input.files[0];

      if (file) {
        var reader = new FileReader();

        reader.onload = function (e) {
          var img = document.createElement('img');
          img.src = e.target.result;
          img.style.maxWidth = '100%';
          img.style.maxHeight = '100%';
          preview.appendChild(img);
        };

        reader.readAsDataURL(file);
      }
    }
  </script>

  <!--
<script>
    const like_btn = document.getElementById("like-button")
    like_btn.addEventListener('click', changeBtnColor)
    function changeBtnColor(e) {
        e.preventDefault()
        like_btn.classList.toggle('text-textCol');
        like_btn.classList.toggle('text-red-500');
        like_btn.classList.toggle('fa-regular');
        like_btn.classList.toggle('fa-solid');
    }
    const bookmark_btn = document.getElementById("bookmark-button")
    bookmark_btn.addEventListener('click', changeBookmarkColor)
    function changeBookmarkColor(e) {
        e.preventDefault()
        bookmark_btn.classList.toggle('text-textCol');
        bookmark_btn.classList.toggle('text-priColor');
        bookmark_btn.classList.toggle('fa-regular');
        bookmark_btn.classList.toggle('fa-solid');
    }
</script>
-->

<script>
    const elements = document.querySelectorAll('.like-button');
    
    elements.forEach((element) => {
      // Your code here
        element.addEventListener('click', changeBtnColor)
        function changeBtnColor(e) {
            e.preventDefault()
            element.classList.toggle('text-textCol');
            element.classList.toggle('text-red-500');
            element.classList.toggle('fa-regular');
            element.classList.toggle('fa-solid');
        }

    });

</script>

<script>
    const items = document.querySelectorAll('.follow-btn');
    
    items.forEach((element) => {
      // Your code here
        element.addEventListener('click', stopReload)
        function stopReload(e) {
            e.preventDefault()
            element.preventDefault()
        }

    });

</script>


<script>
//    // Get all elements with the class name 'example'
//const all_elements = document.querySelectorAll('.show-comment');
//
//// Add click event listener to each 'example' div
//all_elements.forEach((div) => {
//    div.addEventListener('click', () => {
//        // Get all elements with the class name 'example'
//        const all_comments = document.querySelectorAll('.comment-replies');
//        
//        // Iterate through each 'example' div and display its class name
//        all_comments.forEach((element) => {
//            element.classList.toggle('hidden');
//            element.classList.toggle('flex');
//        });
//    });
//});
//</script>



</body>
{% endblock contents %}